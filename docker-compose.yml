services:

  # DB TEST
  db-test:
    image: mysql:8.0.32
    env_file:
      - microservices/db/.env.db-test
    command:
      - --table_definition_cache=100
      - --performance_schema=0
      - --default-authentication-plugin=mysql_native_password
      - --innodb_use_native_aio=0
    container_name: db-test
    ports:
      - 33081:3306
    volumes:
      - ./microservices/db/data/test:/var/lib/mysql

  # DB datacv
  db-cv:
    image: mysql:8.0.32
    env_file:
      - microservices/db/.env.db-cv
    command:
      - --table_definition_cache=100
      - --performance_schema=0
      - --default-authentication-plugin=mysql_native_password
      - --innodb_use_native_aio=0
    container_name: db-cv
    ports:
      - 33082:3306
    volumes:
      - ./microservices/db/data/datacv:/var/lib/mysql
      
  phpmyadmin:
    container_name: phpmyadmin
    depends_on:
      - db-cv
    image: phpmyadmin/phpmyadmin
    env_file:
      - microservices/db/.env.db-geo
    ports:
      - 8081:80
    environment:
      PMA_HOST: db-cv
    
# microservice creacv
  creacv:
    container_name: creacv
    build:
      context: .
      dockerfile: microservices/creacv/Dockerfile
    entrypoint: php -S 0.0.0.0:80 -t public
    environment:
      XDEBUG_MODE: develop,debug
      XDEBUG_CONFIG: client_host=host.docker.internal client_port=9003
    volumes:
      - ./microservices/creacv/project:/creacv # cartella progetto
      - ./microservices/creacv/xdebug/docker-php-ext-xdebug.ini:/usr/local/etc/php/conf.d/docker-php-ext-xdebug.ini # impostazioni per debug
      - ./microservices/creacv/php/php.ini:/usr/local/etc/php/php.ini # impostazioni php
    extra_hosts:
      - "host.docker.internal:host-gateway"
    ports:
      - 8000:80
